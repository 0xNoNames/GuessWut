"use strict";

$(function () {
    var socket = io();

    socket.on('username_msg', (socket_msg) => {
        $('#username_msg').show().html(socket_msg);
    });

    socket.on('game_msg', (socket_msg) => {
        $('#game_msg').html(socket_msg);
    });

    socket.on('image', (socket_img) => {
        $('#game_image').attr("src", socket_img);
    });

    socket.on('ready', () => {
        $('#username_div').remove();
        $('body').prepend('<div id="game_msg"></div><div id="score_div"><nav id="score_msg"></nav></div><img id="game_image"/><div id="chat_div"><nav id="chat_msg"></nav></div><div id="guess_div"><form id="guess_form" action=""><input id="guess_input" autocomplete="off" placeholder="Essayez un mot..." /></form></div>');
        $('#guess_input').focus();
        $('#guess_form').submit(function (e) {
            e.preventDefault();
            if ($('#guess_input').val() != '' && $('#guess_input').val()) {
                socket.emit('guess', $('#guess_input').val());
                $('#guess_input').val('');
            }
        });
    });

    socket.on('update', (socket_msg) => {
        var userPointsArray = JSON.parse(socket_msg);
        userPointsArray.sort(function (a, b) {
            return b[1] - a[1];
        });
        $('#score_msg').html('');
        for (let i = 0; i < userPointsArray.length; i++) {
            $('#score_msg').append('<ul><span>' + userPointsArray[i][0] + '</span><span>' +
                userPointsArray[i][1] + '</span></ul>');
        }
    });

    socket.on('chat', (socket_chat) => {
        console.log(socket_chat)
    });

    socket.on('restart', () => {
        $('#guess_input').val('');
    });

    $('#score_msg').css("translateY", $(this).height())

    $('#username_form').submit(function (e) {
        e.preventDefault();
        if ($('#username_input').val() != '' && $('#username_input').val()) socket.emit('username', $('#username_input').val());
    });
});