"use strict";

$(document).ready(() => {
    $('#backButton').click(() => {
        location.href = '/';
    });

    $('#uploadInput').change(() => {
        if ($('#uploadInput').val() != '') $('#uploadInput').css('background-color', '#90ee90');
        else $('#uploadInput').css('background-color', 'white');
        if ($('#uploadInput').val() != '' && $('#input-uploadFile').val() != "") $('#uploadButton').css('background-color', '#90ee90')
        else $('#uploadButton').css('background-color', '#cd5b5b');
    });

    $('#input-uploadFile').change(() => {
        if ($('#input-uploadFile').val() != "") {
            var input = document.getElementById("input-uploadFile");
            var fReader = new FileReader();
            fReader.readAsDataURL(input.files[0]);
            fReader.onloadend = function (event) {
                $('#label-uploadFile').unbind('mouseenter').unbind('mouseleave').html(input.files[0].name).css('background-image', "url(" + event.target.result + ")");
            }
        } else $('#label-uploadFile').html("Choisir un fichier").hover((event) => mousein(), (event) => mouseout());
        if ($('#uploadInput').val() != '' && $('#input-uploadFile').val() != "") $('#uploadButton').css('background-color', '#90ee90');
        else $('#uploadButton').css('background-color', '#cd5b5b');
    });

    function mousein() {
        $('#label-uploadFile').css({
            "color": "white",
            "background-image": "url('/assets/favicon/favicon-256x256.png')",
            "background-size": "100% 100%",
            "background-repeat": "no-repeat"
        })
    }

    function mouseout() {
        $('#label-uploadFile').css({
            "color": "black",
            "background-image": "none"
        })
    }

    $("#label-uploadFile").hover((event) => mousein(), (event) => mouseout());

    $('#label-uploadFile').click(function () {
        $('#input-uploadFile').click();
    });

    $('#uploadButton').click(function (event) {
        event.preventDefault()
        var form = $('#uploadForm')[0];
        var data = new FormData(form);
        $.ajax({
            type: "post",
            enctype: 'multipart/form-data',
            url: "upload",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            success: (data) => {
                if (data.success) {
                    var source = "assets/stonks.mp3"
                    var audio = document.createElement("audio");
                    audio.autoplay = true;
                    audio.load()
                    audio.addEventListener("load", function () {
                        audio.play();
                    }, true);
                    audio.src = source;
                    audio.volume = 0.05;
                    $('#uploadInput').val('').css('background-color', 'white');
                    mouseout();
                    $('#label-uploadFile').html("Choisir un fichier").hover((event) => mousein(), (event) => mouseout());
                    $('#uploadButton').css('background-color', '#cd5b5b');
                }
                $("#alert_msg").text(data.msg);
            },
            error: (e) => {
                $("#alert_msg").text(e.responseText);
            }
        });
    })
})