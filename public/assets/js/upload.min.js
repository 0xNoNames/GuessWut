"use strict";

$(document).ready(() => {
    $('#backButton').click(() => {
        location.href = '/';
    });

    $('#uploadInput').change(() => {
        if ($('#uploadInput').val() != '') $('#uploadInput').css('background-color', '#90ee90');
        else $('#uploadInput').css('background-color', 'white');
        if ($('#uploadInput').val() != '' && $('#input-uploadFile').val() != "") $('#uploadButton').css('background-color', '#90ee90')
        else $('#uploadButton').css('background-color', '#cd5b5b');
    });

    $('#input-uploadFile').change(() => {
        if ($('#input-uploadFile').val() != "") $('#label-uploadFile').html("C'est tout bon !").css('background-color', '#90ee90');
        else $('#label-uploadFile').html("Choisir un fichier").css('background-color', 'white');
        if ($('#uploadInput').val() != '' && $('#input-uploadFile').val() != "") $('#uploadButton').css('background-color', '#90ee90');
        else $('#uploadButton').css('background-color', '#cd5b5b');
    });

    $('#label-uploadFile').click(function () {
        $('#input-uploadFile').click();
    });

    $('#uploadButton').click(function (event) {
        event.preventDefault()
        var form = $('#uploadForm')[0];
        var data = new FormData(form);
        $.ajax({
            type: "post",
            enctype: 'multipart/form-data',
            url: "upload",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            success: (data) => {
                if (data.success) {
                    var source = "assets/stonks.mp3"
                    var audio = document.createElement("audio");
                    audio.autoplay = true;
                    audio.load()
                    audio.addEventListener("load", function () {
                        audio.play();
                    }, true);
                    audio.src = source;
                    audio.volume = 0.05;
                    $('#uploadFile, #uploadInput').val('').css('background-color', 'white');
                    $('#label-uploadFile').html("Choisir un fichier").css('background-color', 'white');
                    $('#uploadButton').css('background-color', '#cd5b5b')
                }
                $("#alert_msg").text(data.msg);
            },
            error: (e) => {
                $("#alert_msg").text(e.responseText);
            }
        });
    })
})